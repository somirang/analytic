{"ast":null,"code":"import _regeneratorRuntime from\"/Users/haesol/Desktop/mediround-user-web-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/haesol/Desktop/mediround-user-web-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/haesol/Desktop/mediround-user-web-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from\"react\";import{FormattedMessage}from\"react-intl\";import{useSelector}from\"react-redux\";import{fetchUserQuotes,rejectQuote}from\"../../api/quote\";import WaitingCard from\"../../components/Card/WaitingCard\";import Modal from\"../../components/Modal/Modal\";import{getCstFullDatetimeString,MATCHED}from\"../../utils\";import{Loading}from\"../Hospital/Containers/Request\";import\"./Waiting.scss\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var Waiting=function Waiting(props){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),showModal=_useState2[0],setShowModal=_useState2[1];var _useState3=useState(true),_useState4=_slicedToArray(_useState3,2),isLoading=_useState4[0],setIsLoading=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),matchedQuotes=_useState6[0],setMatchedQuotes=_useState6[1];var _useState7=useState(\"\"),_useState8=_slicedToArray(_useState7,2),targetHid=_useState8[0],setTargetHid=_useState8[1];var _useState9=useState(\"\"),_useState10=_slicedToArray(_useState9,2),targetQid=_useState10[0],setTargetQid=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),isRejecting=_useState12[0],setIsRejecting=_useState12[1];var user=useSelector(function(state){return state.user.current;});var fetchMatchedQuotes=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var quotesData;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return fetchUserQuotes({sub:user.sub});case 2:quotesData=_context.sent;return _context.abrupt(\"return\",quotesData.result.filter(function(quote){return quote.status===MATCHED;}));case 4:case\"end\":return _context.stop();}}},_callee);}));return function fetchMatchedQuotes(){return _ref.apply(this,arguments);};}();useEffect(function(){setIsLoading(true);fetchMatchedQuotes().then(function(quotes){setMatchedQuotes(quotes);setIsLoading(false);}).catch(function(e){console.error(\"Quotes\",e);setIsLoading(false);});},[]);var onCancelHandler=function onCancelHandler(hid,qid){setTargetHid(hid);setTargetQid(qid);setShowModal(true);};var rescheduleHandler=function rescheduleHandler(hid,qid){props.history.push(\"/mypage/reserve/\".concat(hid,\"/\").concat(qid));};var rejectQuoteHandler=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(hid,qid){var isSuccess;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:setIsRejecting(true);_context2.next=3;return rejectQuote({hid:hid,qid:qid});case 3:isSuccess=_context2.sent;if(isSuccess){setIsRejecting(false);setShowModal(false);setIsLoading(true);fetchMatchedQuotes().then(function(quotes){setMatchedQuotes(quotes);setIsLoading(false);}).catch(function(e){console.error(\"Quotes\",e);setIsLoading(false);});}else{setIsRejecting(false);// TODO: show error modal\n}case 5:case\"end\":return _context2.stop();}}},_callee2);}));return function rejectQuoteHandler(_x,_x2){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/_jsx(_Fragment,{children:isLoading?/*#__PURE__*/_jsx(Loading,{}):/*#__PURE__*/_jsxs(\"div\",{className:\"waiting-container\",children:[matchedQuotes.length===0?/*#__PURE__*/_jsx(FormattedMessage,{id:\"waiting.youHaveNot\"}):matchedQuotes.map(function(quote,i){return/*#__PURE__*/_jsx(WaitingCard,{name:quote.hospitalInfo.name,hid:quote.hospitalInfo.id,qid:quote.quoteInfo.id,date:getCstFullDatetimeString(quote.consultTime),onCancelHandler:onCancelHandler,videoLink:quote.meetLinks[0]},i);}),showModal&&/*#__PURE__*/_jsx(Modal,{openController:setShowModal,header:\"Are you sure you want to cancel?\",headerId:\"cancel.msg\",body:\"We might have another schedule that fit yours if you want to reschedule.\",bodyId:\"cancel.text\",closableByClickOutside:true,leftButtonProps:{text:\"Reschedule\",textId:\"button.reschedule\",theme:\"primary\",shape:\"square\",style:{fontSize:\"12px\",fontWeight:\"700\",height:\"40px\"},onClick:function onClick(){return rescheduleHandler(targetHid,targetQid);}},rightButtonProps:{text:\"Yes, cancel\",textId:\"button.yesCancel\",theme:\"white\",shape:\"square\",style:{fontSize:\"12px\",fontWeight:\"700\",height:\"40px\"},isLoading:isRejecting,onClick:function onClick(){return rejectQuoteHandler(targetHid,targetQid);}}})]})});};export default Waiting;","map":{"version":3,"sources":["/Users/haesol/Desktop/mediround-user-web-master/src/pages/My/Waiting.tsx"],"names":["React","useEffect","useState","FormattedMessage","useSelector","fetchUserQuotes","rejectQuote","WaitingCard","Modal","getCstFullDatetimeString","MATCHED","Loading","Waiting","props","showModal","setShowModal","isLoading","setIsLoading","matchedQuotes","setMatchedQuotes","targetHid","setTargetHid","targetQid","setTargetQid","isRejecting","setIsRejecting","user","state","current","fetchMatchedQuotes","sub","quotesData","result","filter","quote","status","then","quotes","catch","e","console","error","onCancelHandler","hid","qid","rescheduleHandler","history","push","rejectQuoteHandler","isSuccess","length","map","i","hospitalInfo","name","id","quoteInfo","consultTime","meetLinks","text","textId","theme","shape","style","fontSize","fontWeight","height","onClick"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport { FormattedMessage } from \"react-intl\";\nimport { useSelector } from \"react-redux\";\nimport { RouteComponentProps } from \"react-router\";\nimport { fetchUserQuotes, rejectQuote } from \"../../api/quote\";\nimport { UserProps } from \"../../auth/auth\";\nimport WaitingCard from \"../../components/Card/WaitingCard\";\nimport Modal from \"../../components/Modal/Modal\";\nimport { RootState } from \"../../store\";\nimport { getCstFullDatetimeString, MATCHED } from \"../../utils\";\nimport { Loading, QuoteDataProps } from \"../Hospital/Containers/Request\";\nimport \"./Waiting.scss\";\n\nconst Waiting = (props: RouteComponentProps) => {\n  const [showModal, setShowModal] = useState(false);\n  const [isLoading, setIsLoading] = useState(true);\n  const [matchedQuotes, setMatchedQuotes] = useState([]);\n  const [targetHid, setTargetHid] = useState(\"\");\n  const [targetQid, setTargetQid] = useState(\"\");\n  const [isRejecting, setIsRejecting] = useState(false);\n  const user: UserProps = useSelector((state: RootState) => state.user.current);\n\n  const fetchMatchedQuotes = async () => {\n    // TODO: get hospital Id\n    const quotesData = await fetchUserQuotes({ sub: user.sub! });\n    return quotesData.result.filter(\n      (quote: QuoteDataProps) => quote.status === MATCHED,\n    );\n  };\n\n  useEffect(() => {\n    setIsLoading(true);\n    fetchMatchedQuotes()\n      .then((quotes) => {\n        setMatchedQuotes(quotes);\n        setIsLoading(false);\n      })\n      .catch((e) => {\n        console.error(\"Quotes\", e);\n        setIsLoading(false);\n      });\n  }, []);\n\n  const onCancelHandler = (hid: string, qid: string) => {\n    setTargetHid(hid);\n    setTargetQid(qid);\n    setShowModal(true);\n  };\n\n  const rescheduleHandler = (hid: string, qid: string) => {\n    props.history.push(`/mypage/reserve/${hid}/${qid}`);\n  };\n\n  const rejectQuoteHandler = async (hid: string, qid: string) => {\n    setIsRejecting(true);\n    const isSuccess = await rejectQuote({ hid, qid });\n    if (isSuccess) {\n      setIsRejecting(false);\n      setShowModal(false);\n      setIsLoading(true);\n      fetchMatchedQuotes()\n        .then((quotes) => {\n          setMatchedQuotes(quotes);\n          setIsLoading(false);\n        })\n        .catch((e) => {\n          console.error(\"Quotes\", e);\n          setIsLoading(false);\n        });\n    } else {\n      setIsRejecting(false);\n      // TODO: show error modal\n    }\n  };\n\n  return (\n    <>\n      {isLoading ? (\n        <Loading />\n      ) : (\n        <div className=\"waiting-container\">\n          {matchedQuotes.length === 0 ? (\n            <FormattedMessage id=\"waiting.youHaveNot\" />\n          ) : (\n            matchedQuotes.map((quote: QuoteDataProps, i) => (\n              <WaitingCard\n                key={i}\n                name={quote.hospitalInfo.name!}\n                hid={quote.hospitalInfo.id!}\n                qid={quote.quoteInfo.id}\n                date={getCstFullDatetimeString(quote.consultTime!)}\n                onCancelHandler={onCancelHandler}\n                videoLink={quote.meetLinks![0]}\n              />\n            ))\n          )}\n          {showModal && (\n            <Modal\n              openController={setShowModal}\n              header=\"Are you sure you want to cancel?\"\n              headerId=\"cancel.msg\"\n              body=\"We might have another schedule that fit yours if you want to reschedule.\"\n              bodyId=\"cancel.text\"\n              closableByClickOutside={true}\n              leftButtonProps={{\n                text: \"Reschedule\",\n                textId: \"button.reschedule\",\n                theme: \"primary\",\n                shape: \"square\",\n                style: { fontSize: \"12px\", fontWeight: \"700\", height: \"40px\" },\n                onClick: () => rescheduleHandler(targetHid, targetQid),\n              }}\n              rightButtonProps={{\n                text: \"Yes, cancel\",\n                textId: \"button.yesCancel\",\n                theme: \"white\",\n                shape: \"square\",\n                style: { fontSize: \"12px\", fontWeight: \"700\", height: \"40px\" },\n                isLoading: isRejecting,\n                onClick: () => rejectQuoteHandler(targetHid, targetQid),\n              }}\n            />\n          )}\n        </div>\n      )}\n    </>\n  );\n};\n\nexport default Waiting;\n"]},"metadata":{},"sourceType":"module"}