{"ast":null,"code":"var _jsxFileName = \"/Users/haesol/Desktop/mediround-user-web-master/src/pages/Form.tsx\",\n    _s = $RefreshSig$();\n\nimport React, { useCallback, useState, useEffect } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport Button from \"../components/Button/Button\";\nimport CategoryButton from \"../components/Button/CategoryButton\";\nimport DescriptionButton from \"../components/Button/DescriptionButton\";\nimport PhotoInput from \"../components/Input/PhotoInput\";\nimport PhotoPreview from \"../components/PhotoPreview/PhotoPreview\";\nimport { setQuote } from \"../store/reducers/quote\";\nimport { dummyData, isUserSignedIn } from \"../utils\";\nimport { SignUpForm } from \"../pages/SignUp\";\nimport \"./Form.scss\";\nimport Status from \"../components/Status/Status\";\nimport { postQuote } from \"../api/quote\";\nimport { FormattedMessage, useIntl } from \"react-intl\";\nimport eyes from \"../images/eyes.png\";\nimport nose from \"../images/nose.png\";\nimport facial_contouring from \"../images/facial_contouring.png\";\nimport breast from \"../images/breast.png\";\nimport liposuction from \"../images/liposuction.png\";\nimport fat_grafting from \"../images/fat_grafting.png\";\nimport skin from \"../images/skin.png\";\nimport petit from \"../images/petit.png\";\nimport mouth from \"../images/mouth.png\";\nimport tooth_eyesight from \"../images/tooth_eyesight.png\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst Form = props => {\n  _s();\n\n  // TODO: fetch rootOptions from DB - replace dummyData\n  const [rootOptions, setRootOptions] = useState(dummyData);\n  const [formList, setFormList] = useState(dummyData);\n  const [step, setStep] = useState(0); // 0 - category, 1 - procedure, 2 - photo, 3 - comment, 4 - done\n\n  const [subStep, setSubStep] = useState(0);\n  const [selectedIds, setSelectedIds] = useState([]);\n  const [result, setResult] = useState([]);\n  const [thumbnails, setThumbnails] = useState([]);\n  const [headerMsgId, setHeaderMsgId] = useState(\"\");\n  const [headerValues, setHeaderValues] = useState({});\n  const [comment, setComment] = useState(\"\");\n  const [isSubmitReady, setIsSubmitReady] = useState(false);\n  const [isSubmitInProgress, setIsSubmitInProgress] = useState(false);\n  const dispatch = useDispatch();\n  const user = useSelector(state => state.user.current);\n  const intl = useIntl();\n  const imagesMap = {\n    eyes,\n    nose,\n    facial_contouring,\n    breast,\n    liposuction,\n    fat_grafting,\n    skin,\n    petit,\n    mouth,\n    tooth_eyesight\n  };\n  useEffect(() => {\n    var _rootOptions$find;\n\n    let msgId = \"\";\n    let values = {};\n\n    switch (step) {\n      case 0:\n        msgId = \"form.case0.msg\";\n        break;\n\n      case 1:\n        const categoryTextId = rootOptions === null || rootOptions === void 0 ? void 0 : (_rootOptions$find = rootOptions.find(category => category.id === result[subStep].categoryId)) === null || _rootOptions$find === void 0 ? void 0 : _rootOptions$find.textId;\n        const categoryName = intl.formatMessage({\n          id: categoryTextId\n        });\n        msgId = \"form.case1.msg\";\n        values = {\n          categoryName\n        };\n        break;\n\n      case 2:\n        const categoryTextIds = result.map(({\n          categoryId\n        }) => {\n          var _rootOptions$find2;\n\n          return rootOptions === null || rootOptions === void 0 ? void 0 : (_rootOptions$find2 = rootOptions.find(category => category.id === categoryId)) === null || _rootOptions$find2 === void 0 ? void 0 : _rootOptions$find2.textId;\n        });\n        const categoryNames = categoryTextIds.map(id => intl.formatMessage({\n          id\n        })).join(\", \");\n        msgId = \"form.case2.msg\";\n        values = {\n          categoryNames\n        };\n        break;\n\n      case 3:\n        msgId = \"form.case3.msg\";\n        break;\n\n      case 4:\n        msgId = \"form.case4.msg\";\n        break;\n\n      case 5:\n        msgId = \"form.case5.msg\";\n        break;\n    }\n\n    setHeaderMsgId(msgId);\n    setHeaderValues(values);\n  }, [step, rootOptions, result, subStep]);\n  const fetchSelectedFormList = useCallback(subStep => {\n    const currCategory = result[subStep];\n    const currFormList = rootOptions === null || rootOptions === void 0 ? void 0 : rootOptions.find(option => option.id === currCategory.categoryId);\n    setSelectedIds((currCategory === null || currCategory === void 0 ? void 0 : currCategory.subCategoryIds) || []);\n    setFormList(currFormList === null || currFormList === void 0 ? void 0 : currFormList.subCategories);\n  }, [result, rootOptions]);\n  const handleSubmit = useCallback(async () => {\n    setIsSubmitInProgress(true);\n    const body = {\n      sub: user.sub,\n      quote: result,\n      comment,\n      timestamp: new Date().getTime()\n    };\n    await postQuote(body);\n    setIsSubmitInProgress(false);\n  }, [comment, result, user]);\n  const goPrev = useCallback(() => {\n    if (step === 1) {\n      if (subStep > 0) {\n        fetchSelectedFormList(subStep - 1);\n        setSubStep(s => s - 1);\n      } else {\n        // TODO: show warning modal - \"data will be gone\"\n        setFormList(rootOptions);\n        setSelectedIds([]);\n        setResult([]);\n        setStep(s => s - 1);\n      }\n    } else if (step === 2) {\n      fetchSelectedFormList(subStep);\n      setStep(s => s - 1);\n    } else {\n      setStep(s => s - 1);\n    }\n  }, [step, subStep, rootOptions, fetchSelectedFormList]);\n  const goNext = useCallback(async () => {\n    if (step === 0) {\n      const categories = formList === null || formList === void 0 ? void 0 : formList.filter(category => selectedIds.includes(category.id)).map(item => item.subCategories);\n      const tempResult = selectedIds.map(id => {\n        return {\n          categoryId: id\n        };\n      });\n      setResult(tempResult);\n      setFormList(categories[0]);\n      setSelectedIds([]);\n      setStep(s => s + 1);\n    } else if (step === 1) {\n      const currCategory = result[subStep];\n      const newCategory = { ...currCategory,\n        subCategoryIds: selectedIds\n      };\n      const newResult = [...result];\n      newResult[subStep] = newCategory;\n      setResult(newResult);\n\n      if (subStep < result.length - 1) {\n        fetchSelectedFormList(subStep + 1);\n        setSubStep(s => s + 1);\n      } else {\n        setStep(s => s + 1);\n      }\n    } else if (step === 2) {\n      setStep(s => s + 1);\n    } else if (step === 3) {\n      if (isUserSignedIn(user)) {\n        await handleSubmit();\n        setStep(s => s + 2);\n      } else {\n        setStep(s => s + 1);\n      }\n    } else if (step === 4) {\n      setStep(s => s + 1);\n      dispatch(setQuote(result));\n      await handleSubmit();\n    } else if (step === 5) {\n      props.history.push(\"/mypage\");\n    } else {\n      setStep(s => s + 1);\n    }\n  }, [step, subStep, result, selectedIds, formList, fetchSelectedFormList, dispatch, props.history, user, handleSubmit]);\n\n  const onSelect = (viewType, id) => () => {\n    setSelectedIds(ids => {\n      if (ids.includes(id)) {\n        return ids.filter(iid => iid !== id);\n      } else {\n        if (viewType === \"sub\") {\n          return [id];\n        } else if (viewType === \"main\" && ids.length < 3) {\n          return ids.concat(id);\n        } else {\n          return ids;\n        }\n      }\n    });\n  };\n\n  const photoUploadHandler = event => {\n    if (event.target.files) {\n      const fileNum = Object.keys(event.target.files).length;\n      const urlsToUpload = [];\n      const filesToUpload = [];\n      Object.entries(event.target.files).forEach(([_, file]) => {\n        let reader = new FileReader(); // let file = event.target.files![fileIndex];\n        // TODO : 취소하고 창 닫았을 때 에러처리\n\n        reader.readAsDataURL(file);\n\n        reader.onloadend = () => {\n          const url = reader.result;\n\n          if (url) {\n            urlsToUpload.push(url.toString());\n            filesToUpload.push(file);\n\n            if (urlsToUpload.length === fileNum) {\n              setThumbnails([...thumbnails, ...urlsToUpload]); // setImageAttachments([...imageAttachments, ...filesToUpload]);\n            }\n          } else {\n            throw new Error(\"Error: occured while reading file\");\n          }\n        };\n      });\n    }\n  };\n\n  const photoDeleteHandler = photoInd => {\n    const newThumbnails = thumbnails.slice();\n    newThumbnails.splice(photoInd, 1);\n    setThumbnails(newThumbnails);\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"form-page-container\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"form-header-container\",\n      children: [/*#__PURE__*/_jsxDEV(Status, {\n        step: step,\n        subStep: subStep,\n        maxSubStep: result.length,\n        isSignedIn: isUserSignedIn(user)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 272,\n        columnNumber: 9\n      }, this), headerMsgId && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"form-header-msg\",\n        children: /*#__PURE__*/_jsxDEV(FormattedMessage, {\n          id: headerMsgId,\n          values: headerValues\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 281,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 280,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 271,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: `form-body-container ${step === 0 ? \"grid-view\" : \"\"}`,\n      children: step < 2 ? formList === null || formList === void 0 ? void 0 : formList.map(data => step === 0 ? /*#__PURE__*/_jsxDEV(CategoryButton, {\n        text: data.name,\n        textId: data.textId,\n        selectedIds: selectedIds,\n        id: data.id,\n        onClick: onSelect(\"main\", data.id),\n        image: imagesMap[data.id]\n      }, data.id, false, {\n        fileName: _jsxFileName,\n        lineNumber: 289,\n        columnNumber: 15\n      }, this) : /*#__PURE__*/_jsxDEV(DescriptionButton, {\n        text: data.name,\n        textId: data.textId,\n        selectedIds: selectedIds,\n        id: data.id,\n        onClick: onSelect(\"sub\", data.id)\n      }, data.id, false, {\n        fileName: _jsxFileName,\n        lineNumber: 299,\n        columnNumber: 15\n      }, this)) : step === 2 ? /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"form-thumbnails-container\",\n        children: [thumbnails.map((thumbnail, ind) => /*#__PURE__*/_jsxDEV(PhotoPreview, {\n          src: thumbnail,\n          photoInd: ind,\n          deleteNthPhoto: photoDeleteHandler\n        }, ind, false, {\n          fileName: _jsxFileName,\n          lineNumber: 312,\n          columnNumber: 15\n        }, this)), /*#__PURE__*/_jsxDEV(PhotoInput, {\n          onPhotoUpload: photoUploadHandler\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 319,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 310,\n        columnNumber: 11\n      }, this) : step === 3 ? /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"form-comment-container\",\n        children: /*#__PURE__*/_jsxDEV(FormattedMessage, {\n          id: \"placeholder.leaveComment\",\n          children: message => /*#__PURE__*/_jsxDEV(\"textarea\", {\n            className: \"form-comment-textarea\",\n            placeholder: message,\n            value: comment,\n            onChange: e => setComment(e.target.value)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 325,\n            columnNumber: 17\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 323,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 322,\n        columnNumber: 11\n      }, this) : step === 4 ? /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"signup-page-container no-padding\",\n        children: /*#__PURE__*/_jsxDEV(SignUpForm, {\n          setSubmitReady: setIsSubmitReady\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 336,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 335,\n        columnNumber: 11\n      }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"form-complete-container\",\n        children: /*#__PURE__*/_jsxDEV(FormattedMessage, {\n          id: \"form.case5.text\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 340,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 339,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 285,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"form-footer-button-container\",\n      children: [step > 0 && step < 5 && /*#__PURE__*/_jsxDEV(Button, {\n        text: \"Prev\",\n        textId: \"button.previous\",\n        theme: \"gray\",\n        shape: \"round\",\n        onClick: goPrev\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 346,\n        columnNumber: 11\n      }, this), step > 0 && step < 5 && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"form-footer-gap\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 354,\n        columnNumber: 34\n      }, this), /*#__PURE__*/_jsxDEV(Button, {\n        text: isUserSignedIn(user) && step === 3 || step === 4 ? \"Submit\" : step === 5 ? \"Go to My Page\" : \"Next\",\n        textId: isUserSignedIn(user) && step === 3 || step === 4 ? \"button.submit\" : step === 5 ? \"button.goToMyPage\" : \"button.next\",\n        theme: \"primary\",\n        shape: \"round\",\n        onClick: goNext,\n        isDisabled: selectedIds.length === 0 || step === 4 && !isSubmitReady,\n        isLoading: isSubmitInProgress\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 355,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 344,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 270,\n    columnNumber: 5\n  }, this);\n};\n\n_s(Form, \"1v+WCxLMz8QgibhOYciQpdTkf6o=\", false, function () {\n  return [useDispatch, useSelector, useIntl];\n});\n\n_c = Form;\nexport default Form;\n\nvar _c;\n\n$RefreshReg$(_c, \"Form\");","map":{"version":3,"sources":["/Users/haesol/Desktop/mediround-user-web-master/src/pages/Form.tsx"],"names":["React","useCallback","useState","useEffect","useDispatch","useSelector","Button","CategoryButton","DescriptionButton","PhotoInput","PhotoPreview","setQuote","dummyData","isUserSignedIn","SignUpForm","Status","postQuote","FormattedMessage","useIntl","eyes","nose","facial_contouring","breast","liposuction","fat_grafting","skin","petit","mouth","tooth_eyesight","Form","props","rootOptions","setRootOptions","formList","setFormList","step","setStep","subStep","setSubStep","selectedIds","setSelectedIds","result","setResult","thumbnails","setThumbnails","headerMsgId","setHeaderMsgId","headerValues","setHeaderValues","comment","setComment","isSubmitReady","setIsSubmitReady","isSubmitInProgress","setIsSubmitInProgress","dispatch","user","state","current","intl","imagesMap","msgId","values","categoryTextId","find","category","id","categoryId","textId","categoryName","formatMessage","categoryTextIds","map","categoryNames","join","fetchSelectedFormList","currCategory","currFormList","option","subCategoryIds","subCategories","handleSubmit","body","sub","quote","timestamp","Date","getTime","goPrev","s","goNext","categories","filter","includes","item","tempResult","newCategory","newResult","length","history","push","onSelect","viewType","ids","iid","concat","photoUploadHandler","event","target","files","fileNum","Object","keys","urlsToUpload","filesToUpload","entries","forEach","_","file","reader","FileReader","readAsDataURL","onloadend","url","toString","Error","photoDeleteHandler","photoInd","newThumbnails","slice","splice","data","name","thumbnail","ind","message","e","value"],"mappings":"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","sourcesContent":["import React, { useCallback, useState, useEffect } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { RouteComponentProps } from \"react-router\";\nimport Button from \"../components/Button/Button\";\nimport CategoryButton from \"../components/Button/CategoryButton\";\nimport DescriptionButton from \"../components/Button/DescriptionButton\";\nimport PhotoInput from \"../components/Input/PhotoInput\";\nimport PhotoPreview from \"../components/PhotoPreview/PhotoPreview\";\nimport { setQuote } from \"../store/reducers/quote\";\nimport { dummyData, isUserSignedIn } from \"../utils\";\nimport { SignUpForm } from \"../pages/SignUp\";\n\nimport \"./Form.scss\";\nimport Status from \"../components/Status/Status\";\nimport { postQuote } from \"../api/quote\";\nimport { RootState } from \"../store\";\nimport { UserProps } from \"../auth/auth\";\nimport { FormattedMessage, useIntl } from \"react-intl\";\n\nimport eyes from \"../images/eyes.png\";\nimport nose from \"../images/nose.png\";\nimport facial_contouring from \"../images/facial_contouring.png\";\nimport breast from \"../images/breast.png\";\nimport liposuction from \"../images/liposuction.png\";\nimport fat_grafting from \"../images/fat_grafting.png\";\nimport skin from \"../images/skin.png\";\nimport petit from \"../images/petit.png\";\nimport mouth from \"../images/mouth.png\";\nimport tooth_eyesight from \"../images/tooth_eyesight.png\";\n\ninterface SurgicalOption {\n  name: string;\n  id: string;\n  textId?: string;\n  subCategories?: SurgicalOption[];\n  done?: boolean;\n}\n\ninterface Selection {\n  categoryId: string;\n  subCategoryIds?: string[];\n}\n\ninterface Props extends RouteComponentProps {}\n\nconst Form = (props: Props) => {\n  // TODO: fetch rootOptions from DB - replace dummyData\n  const [rootOptions, setRootOptions] =\n    useState<SurgicalOption[] | undefined>(dummyData);\n  const [formList, setFormList] =\n    useState<SurgicalOption[] | undefined>(dummyData);\n  const [step, setStep] = useState(0); // 0 - category, 1 - procedure, 2 - photo, 3 - comment, 4 - done\n  const [subStep, setSubStep] = useState(0);\n  const [selectedIds, setSelectedIds] = useState<string[]>([]);\n  const [result, setResult] = useState<Selection[]>([]);\n  const [thumbnails, setThumbnails] = useState<string[]>([]);\n  const [headerMsgId, setHeaderMsgId] = useState(\"\");\n  const [headerValues, setHeaderValues] = useState({});\n  const [comment, setComment] = useState(\"\");\n  const [isSubmitReady, setIsSubmitReady] = useState(false);\n  const [isSubmitInProgress, setIsSubmitInProgress] = useState(false);\n  const dispatch = useDispatch();\n  const user: UserProps = useSelector((state: RootState) => state.user.current);\n  const intl = useIntl();\n\n  const imagesMap: { [key: string]: string } = {\n    eyes,\n    nose,\n    facial_contouring,\n    breast,\n    liposuction,\n    fat_grafting,\n    skin,\n    petit,\n    mouth,\n    tooth_eyesight,\n  };\n\n  useEffect(() => {\n    let msgId = \"\";\n    let values = {};\n    switch (step) {\n      case 0:\n        msgId = \"form.case0.msg\";\n        break;\n      case 1:\n        const categoryTextId = rootOptions?.find(\n          (category) => category.id === result[subStep].categoryId,\n        )?.textId;\n        const categoryName = intl.formatMessage({ id: categoryTextId });\n        msgId = \"form.case1.msg\";\n        values = { categoryName };\n        break;\n      case 2:\n        const categoryTextIds = result.map(\n          ({ categoryId }) =>\n            rootOptions?.find((category) => category.id === categoryId)?.textId,\n        );\n        const categoryNames = categoryTextIds\n          .map((id) => intl.formatMessage({ id }))\n          .join(\", \");\n        msgId = \"form.case2.msg\";\n        values = { categoryNames };\n        break;\n      case 3:\n        msgId = \"form.case3.msg\";\n        break;\n      case 4:\n        msgId = \"form.case4.msg\";\n        break;\n      case 5:\n        msgId = \"form.case5.msg\";\n        break;\n    }\n    setHeaderMsgId(msgId);\n    setHeaderValues(values);\n  }, [step, rootOptions, result, subStep]);\n\n  const fetchSelectedFormList = useCallback(\n    (subStep) => {\n      const currCategory = result[subStep];\n      const currFormList = rootOptions?.find(\n        (option) => option.id === currCategory.categoryId,\n      );\n      setSelectedIds(currCategory?.subCategoryIds || []);\n      setFormList(currFormList?.subCategories);\n    },\n    [result, rootOptions],\n  );\n\n  const handleSubmit = useCallback(async () => {\n    setIsSubmitInProgress(true);\n    const body = {\n      sub: user.sub!,\n      quote: result,\n      comment,\n      timestamp: new Date().getTime(),\n    };\n    await postQuote(body);\n    setIsSubmitInProgress(false);\n  }, [comment, result, user]);\n\n  const goPrev = useCallback(() => {\n    if (step === 1) {\n      if (subStep > 0) {\n        fetchSelectedFormList(subStep - 1);\n        setSubStep((s) => s - 1);\n      } else {\n        // TODO: show warning modal - \"data will be gone\"\n        setFormList(rootOptions);\n        setSelectedIds([]);\n        setResult([]);\n        setStep((s) => s - 1);\n      }\n    } else if (step === 2) {\n      fetchSelectedFormList(subStep);\n      setStep((s) => s - 1);\n    } else {\n      setStep((s) => s - 1);\n    }\n  }, [step, subStep, rootOptions, fetchSelectedFormList]);\n\n  const goNext = useCallback(async () => {\n    if (step === 0) {\n      const categories = formList\n        ?.filter((category) => selectedIds.includes(category.id))\n        .map((item) => item.subCategories);\n      const tempResult = selectedIds.map((id) => {\n        return { categoryId: id };\n      });\n      setResult(tempResult);\n      setFormList(categories![0]);\n      setSelectedIds([]);\n      setStep((s) => s + 1);\n    } else if (step === 1) {\n      const currCategory = result[subStep];\n      const newCategory = { ...currCategory, subCategoryIds: selectedIds };\n      const newResult = [...result];\n      newResult[subStep] = newCategory;\n      setResult(newResult);\n      if (subStep < result.length - 1) {\n        fetchSelectedFormList(subStep + 1);\n        setSubStep((s) => s + 1);\n      } else {\n        setStep((s) => s + 1);\n      }\n    } else if (step === 2) {\n      setStep((s) => s + 1);\n    } else if (step === 3) {\n      if (isUserSignedIn(user)) {\n        await handleSubmit();\n        setStep((s) => s + 2);\n      } else {\n        setStep((s) => s + 1);\n      }\n    } else if (step === 4) {\n      setStep((s) => s + 1);\n      dispatch(setQuote(result));\n\n      await handleSubmit();\n    } else if (step === 5) {\n      props.history.push(\"/mypage\");\n    } else {\n      setStep((s) => s + 1);\n    }\n  }, [\n    step,\n    subStep,\n    result,\n    selectedIds,\n    formList,\n    fetchSelectedFormList,\n    dispatch,\n    props.history,\n    user,\n    handleSubmit,\n  ]);\n\n  const onSelect = (viewType: string, id: string) => () => {\n    setSelectedIds((ids) => {\n      if (ids.includes(id)) {\n        return ids.filter((iid) => iid !== id);\n      } else {\n        if (viewType === \"sub\") {\n          return [id];\n        } else if (viewType === \"main\" && ids.length < 3) {\n          return ids.concat(id);\n        } else {\n          return ids;\n        }\n      }\n    });\n  };\n\n  const photoUploadHandler = (event: React.ChangeEvent<HTMLInputElement>) => {\n    if (event.target.files) {\n      const fileNum = Object.keys(event.target.files).length;\n      const urlsToUpload: string[] = [];\n      const filesToUpload = [];\n\n      Object.entries(event.target.files).forEach(([_, file]) => {\n        let reader = new FileReader();\n        // let file = event.target.files![fileIndex];\n        // TODO : 취소하고 창 닫았을 때 에러처리\n        reader.readAsDataURL(file);\n        reader.onloadend = () => {\n          const url = reader.result;\n          if (url) {\n            urlsToUpload.push(url.toString());\n            filesToUpload.push(file);\n            if (urlsToUpload.length === fileNum) {\n              setThumbnails([...thumbnails, ...urlsToUpload]);\n              // setImageAttachments([...imageAttachments, ...filesToUpload]);\n            }\n          } else {\n            throw new Error(\"Error: occured while reading file\");\n          }\n        };\n      });\n    }\n  };\n\n  const photoDeleteHandler = (photoInd: number) => {\n    const newThumbnails = thumbnails.slice();\n    newThumbnails.splice(photoInd, 1);\n    setThumbnails(newThumbnails);\n  };\n\n  return (\n    <div className=\"form-page-container\">\n      <div className=\"form-header-container\">\n        <Status\n          step={step}\n          subStep={subStep}\n          maxSubStep={result.length}\n          isSignedIn={isUserSignedIn(user)}\n        />\n        {/* TODO: category preview */}\n        {headerMsgId && (\n          <div className=\"form-header-msg\">\n            <FormattedMessage id={headerMsgId} values={headerValues} />\n          </div>\n        )}\n      </div>\n      <div className={`form-body-container ${step === 0 ? \"grid-view\" : \"\"}`}>\n        {step < 2 ? (\n          formList?.map((data: SurgicalOption) =>\n            step === 0 ? (\n              <CategoryButton\n                text={data.name}\n                textId={data.textId}\n                key={data.id}\n                selectedIds={selectedIds}\n                id={data.id}\n                onClick={onSelect(\"main\", data.id)}\n                image={imagesMap[data.id]}\n              />\n            ) : (\n              <DescriptionButton\n                text={data.name}\n                textId={data.textId}\n                key={data.id}\n                selectedIds={selectedIds}\n                id={data.id}\n                onClick={onSelect(\"sub\", data.id)}\n              />\n            ),\n          )\n        ) : step === 2 ? (\n          <div className=\"form-thumbnails-container\">\n            {thumbnails.map((thumbnail, ind) => (\n              <PhotoPreview\n                key={ind}\n                src={thumbnail}\n                photoInd={ind}\n                deleteNthPhoto={photoDeleteHandler}\n              />\n            ))}\n            <PhotoInput onPhotoUpload={photoUploadHandler} />\n          </div>\n        ) : step === 3 ? (\n          <div className=\"form-comment-container\">\n            <FormattedMessage id=\"placeholder.leaveComment\">\n              {(message: string) => (\n                <textarea\n                  className=\"form-comment-textarea\"\n                  placeholder={message}\n                  value={comment}\n                  onChange={(e) => setComment(e.target.value)}\n                />\n              )}\n            </FormattedMessage>\n          </div>\n        ) : step === 4 ? (\n          <div className=\"signup-page-container no-padding\">\n            <SignUpForm setSubmitReady={setIsSubmitReady} />\n          </div>\n        ) : (\n          <div className=\"form-complete-container\">\n            <FormattedMessage id=\"form.case5.text\" />\n          </div>\n        )}\n      </div>\n      <div className=\"form-footer-button-container\">\n        {step > 0 && step < 5 && (\n          <Button\n            text=\"Prev\"\n            textId=\"button.previous\"\n            theme=\"gray\"\n            shape=\"round\"\n            onClick={goPrev}\n          />\n        )}\n        {step > 0 && step < 5 && <div className=\"form-footer-gap\" />}\n        <Button\n          text={\n            (isUserSignedIn(user) && step === 3) || step === 4\n              ? \"Submit\"\n              : step === 5\n              ? \"Go to My Page\"\n              : \"Next\"\n          }\n          textId={\n            (isUserSignedIn(user) && step === 3) || step === 4\n              ? \"button.submit\"\n              : step === 5\n              ? \"button.goToMyPage\"\n              : \"button.next\"\n          }\n          theme=\"primary\"\n          shape=\"round\"\n          onClick={goNext}\n          isDisabled={\n            selectedIds.length === 0 || (step === 4 && !isSubmitReady)\n          }\n          isLoading={isSubmitInProgress}\n        />\n      </div>\n    </div>\n  );\n};\n\nexport default Form;\n"]},"metadata":{},"sourceType":"module"}