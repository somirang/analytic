{"ast":null,"code":"import _toConsumableArray from\"/Users/haesol/Desktop/mediround-user-web-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _objectSpread from\"/Users/haesol/Desktop/mediround-user-web-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"/Users/haesol/Desktop/mediround-user-web-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/haesol/Desktop/mediround-user-web-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/haesol/Desktop/mediround-user-web-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useCallback,useState,useEffect}from\"react\";import{useDispatch,useSelector}from\"react-redux\";import Button from\"../components/Button/Button\";import CategoryButton from\"../components/Button/CategoryButton\";import DescriptionButton from\"../components/Button/DescriptionButton\";import PhotoInput from\"../components/Input/PhotoInput\";import PhotoPreview from\"../components/PhotoPreview/PhotoPreview\";import{setQuote}from\"../store/reducers/quote\";import{dummyData,isUserSignedIn}from\"../utils\";import{SignUpForm}from\"../pages/SignUp\";import\"./Form.scss\";import Status from\"../components/Status/Status\";import{postQuote}from\"../api/quote\";import{FormattedMessage,useIntl}from\"react-intl\";import eyes from\"../images/eyes.png\";import nose from\"../images/nose.png\";import facial_contouring from\"../images/facial_contouring.png\";import breast from\"../images/breast.png\";import liposuction from\"../images/liposuction.png\";import fat_grafting from\"../images/fat_grafting.png\";import skin from\"../images/skin.png\";import petit from\"../images/petit.png\";import mouth from\"../images/mouth.png\";import tooth_eyesight from\"../images/tooth_eyesight.png\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Form=function Form(props){// TODO: fetch rootOptions from DB - replace dummyData\nvar _useState=useState(dummyData),_useState2=_slicedToArray(_useState,2),rootOptions=_useState2[0],setRootOptions=_useState2[1];var _useState3=useState(dummyData),_useState4=_slicedToArray(_useState3,2),formList=_useState4[0],setFormList=_useState4[1];var _useState5=useState(0),_useState6=_slicedToArray(_useState5,2),step=_useState6[0],setStep=_useState6[1];// 0 - category, 1 - procedure, 2 - photo, 3 - comment, 4 - done\nvar _useState7=useState(0),_useState8=_slicedToArray(_useState7,2),subStep=_useState8[0],setSubStep=_useState8[1];var _useState9=useState([]),_useState10=_slicedToArray(_useState9,2),selectedIds=_useState10[0],setSelectedIds=_useState10[1];var _useState11=useState([]),_useState12=_slicedToArray(_useState11,2),result=_useState12[0],setResult=_useState12[1];var _useState13=useState([]),_useState14=_slicedToArray(_useState13,2),thumbnails=_useState14[0],setThumbnails=_useState14[1];var _useState15=useState(\"\"),_useState16=_slicedToArray(_useState15,2),headerMsgId=_useState16[0],setHeaderMsgId=_useState16[1];var _useState17=useState({}),_useState18=_slicedToArray(_useState17,2),headerValues=_useState18[0],setHeaderValues=_useState18[1];var _useState19=useState(\"\"),_useState20=_slicedToArray(_useState19,2),comment=_useState20[0],setComment=_useState20[1];var _useState21=useState(false),_useState22=_slicedToArray(_useState21,2),isSubmitReady=_useState22[0],setIsSubmitReady=_useState22[1];var _useState23=useState(false),_useState24=_slicedToArray(_useState23,2),isSubmitInProgress=_useState24[0],setIsSubmitInProgress=_useState24[1];var dispatch=useDispatch();var user=useSelector(function(state){return state.user.current;});var intl=useIntl();var imagesMap={eyes:eyes,nose:nose,facial_contouring:facial_contouring,breast:breast,liposuction:liposuction,fat_grafting:fat_grafting,skin:skin,petit:petit,mouth:mouth,tooth_eyesight:tooth_eyesight};useEffect(function(){var _rootOptions$find;var msgId=\"\";var values={};switch(step){case 0:msgId=\"form.case0.msg\";break;case 1:var categoryTextId=rootOptions===null||rootOptions===void 0?void 0:(_rootOptions$find=rootOptions.find(function(category){return category.id===result[subStep].categoryId;}))===null||_rootOptions$find===void 0?void 0:_rootOptions$find.textId;var categoryName=intl.formatMessage({id:categoryTextId});msgId=\"form.case1.msg\";values={categoryName:categoryName};break;case 2:var categoryTextIds=result.map(function(_ref){var _rootOptions$find2;var categoryId=_ref.categoryId;return rootOptions===null||rootOptions===void 0?void 0:(_rootOptions$find2=rootOptions.find(function(category){return category.id===categoryId;}))===null||_rootOptions$find2===void 0?void 0:_rootOptions$find2.textId;});var categoryNames=categoryTextIds.map(function(id){return intl.formatMessage({id:id});}).join(\", \");msgId=\"form.case2.msg\";values={categoryNames:categoryNames};break;case 3:msgId=\"form.case3.msg\";break;case 4:msgId=\"form.case4.msg\";break;case 5:msgId=\"form.case5.msg\";break;}setHeaderMsgId(msgId);setHeaderValues(values);},[step,rootOptions,result,subStep]);var fetchSelectedFormList=useCallback(function(subStep){var currCategory=result[subStep];var currFormList=rootOptions===null||rootOptions===void 0?void 0:rootOptions.find(function(option){return option.id===currCategory.categoryId;});setSelectedIds((currCategory===null||currCategory===void 0?void 0:currCategory.subCategoryIds)||[]);setFormList(currFormList===null||currFormList===void 0?void 0:currFormList.subCategories);},[result,rootOptions]);var handleSubmit=useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var body;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setIsSubmitInProgress(true);body={sub:user.sub,quote:result,comment:comment,timestamp:new Date().getTime()};_context.next=4;return postQuote(body);case 4:setIsSubmitInProgress(false);case 5:case\"end\":return _context.stop();}}},_callee);})),[comment,result,user]);var goPrev=useCallback(function(){if(step===1){if(subStep>0){fetchSelectedFormList(subStep-1);setSubStep(function(s){return s-1;});}else{// TODO: show warning modal - \"data will be gone\"\nsetFormList(rootOptions);setSelectedIds([]);setResult([]);setStep(function(s){return s-1;});}}else if(step===2){fetchSelectedFormList(subStep);setStep(function(s){return s-1;});}else{setStep(function(s){return s-1;});}},[step,subStep,rootOptions,fetchSelectedFormList]);var goNext=useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var categories,tempResult,currCategory,newCategory,newResult;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!(step===0)){_context2.next=9;break;}categories=formList===null||formList===void 0?void 0:formList.filter(function(category){return selectedIds.includes(category.id);}).map(function(item){return item.subCategories;});tempResult=selectedIds.map(function(id){return{categoryId:id};});setResult(tempResult);setFormList(categories[0]);setSelectedIds([]);setStep(function(s){return s+1;});_context2.next=40;break;case 9:if(!(step===1)){_context2.next=18;break;}currCategory=result[subStep];newCategory=_objectSpread(_objectSpread({},currCategory),{},{subCategoryIds:selectedIds});newResult=_toConsumableArray(result);newResult[subStep]=newCategory;setResult(newResult);if(subStep<result.length-1){fetchSelectedFormList(subStep+1);setSubStep(function(s){return s+1;});}else{setStep(function(s){return s+1;});}_context2.next=40;break;case 18:if(!(step===2)){_context2.next=22;break;}setStep(function(s){return s+1;});_context2.next=40;break;case 22:if(!(step===3)){_context2.next=32;break;}if(!isUserSignedIn(user)){_context2.next=29;break;}_context2.next=26;return handleSubmit();case 26:setStep(function(s){return s+2;});_context2.next=30;break;case 29:setStep(function(s){return s+1;});case 30:_context2.next=40;break;case 32:if(!(step===4)){_context2.next=39;break;}setStep(function(s){return s+1;});dispatch(setQuote(result));_context2.next=37;return handleSubmit();case 37:_context2.next=40;break;case 39:if(step===5){props.history.push(\"/mypage\");}else{setStep(function(s){return s+1;});}case 40:case\"end\":return _context2.stop();}}},_callee2);})),[step,subStep,result,selectedIds,formList,fetchSelectedFormList,dispatch,props.history,user,handleSubmit]);var onSelect=function onSelect(viewType,id){return function(){setSelectedIds(function(ids){if(ids.includes(id)){return ids.filter(function(iid){return iid!==id;});}else{if(viewType===\"sub\"){return[id];}else if(viewType===\"main\"&&ids.length<3){return ids.concat(id);}else{return ids;}}});};};var photoUploadHandler=function photoUploadHandler(event){if(event.target.files){var fileNum=Object.keys(event.target.files).length;var urlsToUpload=[];var filesToUpload=[];Object.entries(event.target.files).forEach(function(_ref4){var _ref5=_slicedToArray(_ref4,2),_=_ref5[0],file=_ref5[1];var reader=new FileReader();// let file = event.target.files![fileIndex];\n// TODO : 취소하고 창 닫았을 때 에러처리\nreader.readAsDataURL(file);reader.onloadend=function(){var url=reader.result;if(url){urlsToUpload.push(url.toString());filesToUpload.push(file);if(urlsToUpload.length===fileNum){setThumbnails([].concat(_toConsumableArray(thumbnails),urlsToUpload));// setImageAttachments([...imageAttachments, ...filesToUpload]);\n}}else{throw new Error(\"Error: occured while reading file\");}};});}};var photoDeleteHandler=function photoDeleteHandler(photoInd){var newThumbnails=thumbnails.slice();newThumbnails.splice(photoInd,1);setThumbnails(newThumbnails);};return/*#__PURE__*/_jsxs(\"div\",{className:\"form-page-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"form-header-container\",children:[/*#__PURE__*/_jsx(Status,{step:step,subStep:subStep,maxSubStep:result.length,isSignedIn:isUserSignedIn(user)}),headerMsgId&&/*#__PURE__*/_jsx(\"div\",{className:\"form-header-msg\",children:/*#__PURE__*/_jsx(FormattedMessage,{id:headerMsgId,values:headerValues})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"form-body-container \".concat(step===0?\"grid-view\":\"\"),children:step<2?formList===null||formList===void 0?void 0:formList.map(function(data){return step===0?/*#__PURE__*/_jsx(CategoryButton,{text:data.name,textId:data.textId,selectedIds:selectedIds,id:data.id,onClick:onSelect(\"main\",data.id),image:imagesMap[data.id]},data.id):/*#__PURE__*/_jsx(DescriptionButton,{text:data.name,textId:data.textId,selectedIds:selectedIds,id:data.id,onClick:onSelect(\"sub\",data.id)},data.id);}):step===2?/*#__PURE__*/_jsxs(\"div\",{className:\"form-thumbnails-container\",children:[thumbnails.map(function(thumbnail,ind){return/*#__PURE__*/_jsx(PhotoPreview,{src:thumbnail,photoInd:ind,deleteNthPhoto:photoDeleteHandler},ind);}),/*#__PURE__*/_jsx(PhotoInput,{onPhotoUpload:photoUploadHandler})]}):step===3?/*#__PURE__*/_jsx(\"div\",{className:\"form-comment-container\",children:/*#__PURE__*/_jsx(FormattedMessage,{id:\"placeholder.leaveComment\",children:function children(message){return/*#__PURE__*/_jsx(\"textarea\",{className:\"form-comment-textarea\",placeholder:message,value:comment,onChange:function onChange(e){return setComment(e.target.value);}});}})}):step===4?/*#__PURE__*/_jsx(\"div\",{className:\"signup-page-container no-padding\",children:/*#__PURE__*/_jsx(SignUpForm,{setSubmitReady:setIsSubmitReady})}):/*#__PURE__*/_jsx(\"div\",{className:\"form-complete-container\",children:/*#__PURE__*/_jsx(FormattedMessage,{id:\"form.case5.text\"})})}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-footer-button-container\",children:[step>0&&step<5&&/*#__PURE__*/_jsx(Button,{text:\"Prev\",textId:\"button.previous\",theme:\"gray\",shape:\"round\",onClick:goPrev}),step>0&&step<5&&/*#__PURE__*/_jsx(\"div\",{className:\"form-footer-gap\"}),/*#__PURE__*/_jsx(Button,{text:isUserSignedIn(user)&&step===3||step===4?\"Submit\":step===5?\"Go to My Page\":\"Next\",textId:isUserSignedIn(user)&&step===3||step===4?\"button.submit\":step===5?\"button.goToMyPage\":\"button.next\",theme:\"primary\",shape:\"round\",onClick:goNext,isDisabled:selectedIds.length===0||step===4&&!isSubmitReady,isLoading:isSubmitInProgress})]})]});};export default Form;","map":{"version":3,"sources":["/Users/haesol/Desktop/mediround-user-web-master/src/pages/Form.tsx"],"names":["React","useCallback","useState","useEffect","useDispatch","useSelector","Button","CategoryButton","DescriptionButton","PhotoInput","PhotoPreview","setQuote","dummyData","isUserSignedIn","SignUpForm","Status","postQuote","FormattedMessage","useIntl","eyes","nose","facial_contouring","breast","liposuction","fat_grafting","skin","petit","mouth","tooth_eyesight","Form","props","rootOptions","setRootOptions","formList","setFormList","step","setStep","subStep","setSubStep","selectedIds","setSelectedIds","result","setResult","thumbnails","setThumbnails","headerMsgId","setHeaderMsgId","headerValues","setHeaderValues","comment","setComment","isSubmitReady","setIsSubmitReady","isSubmitInProgress","setIsSubmitInProgress","dispatch","user","state","current","intl","imagesMap","msgId","values","categoryTextId","find","category","id","categoryId","textId","categoryName","formatMessage","categoryTextIds","map","categoryNames","join","fetchSelectedFormList","currCategory","currFormList","option","subCategoryIds","subCategories","handleSubmit","body","sub","quote","timestamp","Date","getTime","goPrev","s","goNext","categories","filter","includes","item","tempResult","newCategory","newResult","length","history","push","onSelect","viewType","ids","iid","concat","photoUploadHandler","event","target","files","fileNum","Object","keys","urlsToUpload","filesToUpload","entries","forEach","_","file","reader","FileReader","readAsDataURL","onloadend","url","toString","Error","photoDeleteHandler","photoInd","newThumbnails","slice","splice","data","name","thumbnail","ind","message","e","value"],"mappings":"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","sourcesContent":["import React, { useCallback, useState, useEffect } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { RouteComponentProps } from \"react-router\";\nimport Button from \"../components/Button/Button\";\nimport CategoryButton from \"../components/Button/CategoryButton\";\nimport DescriptionButton from \"../components/Button/DescriptionButton\";\nimport PhotoInput from \"../components/Input/PhotoInput\";\nimport PhotoPreview from \"../components/PhotoPreview/PhotoPreview\";\nimport { setQuote } from \"../store/reducers/quote\";\nimport { dummyData, isUserSignedIn } from \"../utils\";\nimport { SignUpForm } from \"../pages/SignUp\";\n\nimport \"./Form.scss\";\nimport Status from \"../components/Status/Status\";\nimport { postQuote } from \"../api/quote\";\nimport { RootState } from \"../store\";\nimport { UserProps } from \"../auth/auth\";\nimport { FormattedMessage, useIntl } from \"react-intl\";\n\nimport eyes from \"../images/eyes.png\";\nimport nose from \"../images/nose.png\";\nimport facial_contouring from \"../images/facial_contouring.png\";\nimport breast from \"../images/breast.png\";\nimport liposuction from \"../images/liposuction.png\";\nimport fat_grafting from \"../images/fat_grafting.png\";\nimport skin from \"../images/skin.png\";\nimport petit from \"../images/petit.png\";\nimport mouth from \"../images/mouth.png\";\nimport tooth_eyesight from \"../images/tooth_eyesight.png\";\n\ninterface SurgicalOption {\n  name: string;\n  id: string;\n  textId?: string;\n  subCategories?: SurgicalOption[];\n  done?: boolean;\n}\n\ninterface Selection {\n  categoryId: string;\n  subCategoryIds?: string[];\n}\n\ninterface Props extends RouteComponentProps {}\n\nconst Form = (props: Props) => {\n  // TODO: fetch rootOptions from DB - replace dummyData\n  const [rootOptions, setRootOptions] =\n    useState<SurgicalOption[] | undefined>(dummyData);\n  const [formList, setFormList] =\n    useState<SurgicalOption[] | undefined>(dummyData);\n  const [step, setStep] = useState(0); // 0 - category, 1 - procedure, 2 - photo, 3 - comment, 4 - done\n  const [subStep, setSubStep] = useState(0);\n  const [selectedIds, setSelectedIds] = useState<string[]>([]);\n  const [result, setResult] = useState<Selection[]>([]);\n  const [thumbnails, setThumbnails] = useState<string[]>([]);\n  const [headerMsgId, setHeaderMsgId] = useState(\"\");\n  const [headerValues, setHeaderValues] = useState({});\n  const [comment, setComment] = useState(\"\");\n  const [isSubmitReady, setIsSubmitReady] = useState(false);\n  const [isSubmitInProgress, setIsSubmitInProgress] = useState(false);\n  const dispatch = useDispatch();\n  const user: UserProps = useSelector((state: RootState) => state.user.current);\n  const intl = useIntl();\n\n  const imagesMap: { [key: string]: string } = {\n    eyes,\n    nose,\n    facial_contouring,\n    breast,\n    liposuction,\n    fat_grafting,\n    skin,\n    petit,\n    mouth,\n    tooth_eyesight,\n  };\n\n  useEffect(() => {\n    let msgId = \"\";\n    let values = {};\n    switch (step) {\n      case 0:\n        msgId = \"form.case0.msg\";\n        break;\n      case 1:\n        const categoryTextId = rootOptions?.find(\n          (category) => category.id === result[subStep].categoryId,\n        )?.textId;\n        const categoryName = intl.formatMessage({ id: categoryTextId });\n        msgId = \"form.case1.msg\";\n        values = { categoryName };\n        break;\n      case 2:\n        const categoryTextIds = result.map(\n          ({ categoryId }) =>\n            rootOptions?.find((category) => category.id === categoryId)?.textId,\n        );\n        const categoryNames = categoryTextIds\n          .map((id) => intl.formatMessage({ id }))\n          .join(\", \");\n        msgId = \"form.case2.msg\";\n        values = { categoryNames };\n        break;\n      case 3:\n        msgId = \"form.case3.msg\";\n        break;\n      case 4:\n        msgId = \"form.case4.msg\";\n        break;\n      case 5:\n        msgId = \"form.case5.msg\";\n        break;\n    }\n    setHeaderMsgId(msgId);\n    setHeaderValues(values);\n  }, [step, rootOptions, result, subStep]);\n\n  const fetchSelectedFormList = useCallback(\n    (subStep) => {\n      const currCategory = result[subStep];\n      const currFormList = rootOptions?.find(\n        (option) => option.id === currCategory.categoryId,\n      );\n      setSelectedIds(currCategory?.subCategoryIds || []);\n      setFormList(currFormList?.subCategories);\n    },\n    [result, rootOptions],\n  );\n\n  const handleSubmit = useCallback(async () => {\n    setIsSubmitInProgress(true);\n    const body = {\n      sub: user.sub!,\n      quote: result,\n      comment,\n      timestamp: new Date().getTime(),\n    };\n    await postQuote(body);\n    setIsSubmitInProgress(false);\n  }, [comment, result, user]);\n\n  const goPrev = useCallback(() => {\n    if (step === 1) {\n      if (subStep > 0) {\n        fetchSelectedFormList(subStep - 1);\n        setSubStep((s) => s - 1);\n      } else {\n        // TODO: show warning modal - \"data will be gone\"\n        setFormList(rootOptions);\n        setSelectedIds([]);\n        setResult([]);\n        setStep((s) => s - 1);\n      }\n    } else if (step === 2) {\n      fetchSelectedFormList(subStep);\n      setStep((s) => s - 1);\n    } else {\n      setStep((s) => s - 1);\n    }\n  }, [step, subStep, rootOptions, fetchSelectedFormList]);\n\n  const goNext = useCallback(async () => {\n    if (step === 0) {\n      const categories = formList\n        ?.filter((category) => selectedIds.includes(category.id))\n        .map((item) => item.subCategories);\n      const tempResult = selectedIds.map((id) => {\n        return { categoryId: id };\n      });\n      setResult(tempResult);\n      setFormList(categories![0]);\n      setSelectedIds([]);\n      setStep((s) => s + 1);\n    } else if (step === 1) {\n      const currCategory = result[subStep];\n      const newCategory = { ...currCategory, subCategoryIds: selectedIds };\n      const newResult = [...result];\n      newResult[subStep] = newCategory;\n      setResult(newResult);\n      if (subStep < result.length - 1) {\n        fetchSelectedFormList(subStep + 1);\n        setSubStep((s) => s + 1);\n      } else {\n        setStep((s) => s + 1);\n      }\n    } else if (step === 2) {\n      setStep((s) => s + 1);\n    } else if (step === 3) {\n      if (isUserSignedIn(user)) {\n        await handleSubmit();\n        setStep((s) => s + 2);\n      } else {\n        setStep((s) => s + 1);\n      }\n    } else if (step === 4) {\n      setStep((s) => s + 1);\n      dispatch(setQuote(result));\n\n      await handleSubmit();\n    } else if (step === 5) {\n      props.history.push(\"/mypage\");\n    } else {\n      setStep((s) => s + 1);\n    }\n  }, [\n    step,\n    subStep,\n    result,\n    selectedIds,\n    formList,\n    fetchSelectedFormList,\n    dispatch,\n    props.history,\n    user,\n    handleSubmit,\n  ]);\n\n  const onSelect = (viewType: string, id: string) => () => {\n    setSelectedIds((ids) => {\n      if (ids.includes(id)) {\n        return ids.filter((iid) => iid !== id);\n      } else {\n        if (viewType === \"sub\") {\n          return [id];\n        } else if (viewType === \"main\" && ids.length < 3) {\n          return ids.concat(id);\n        } else {\n          return ids;\n        }\n      }\n    });\n  };\n\n  const photoUploadHandler = (event: React.ChangeEvent<HTMLInputElement>) => {\n    if (event.target.files) {\n      const fileNum = Object.keys(event.target.files).length;\n      const urlsToUpload: string[] = [];\n      const filesToUpload = [];\n\n      Object.entries(event.target.files).forEach(([_, file]) => {\n        let reader = new FileReader();\n        // let file = event.target.files![fileIndex];\n        // TODO : 취소하고 창 닫았을 때 에러처리\n        reader.readAsDataURL(file);\n        reader.onloadend = () => {\n          const url = reader.result;\n          if (url) {\n            urlsToUpload.push(url.toString());\n            filesToUpload.push(file);\n            if (urlsToUpload.length === fileNum) {\n              setThumbnails([...thumbnails, ...urlsToUpload]);\n              // setImageAttachments([...imageAttachments, ...filesToUpload]);\n            }\n          } else {\n            throw new Error(\"Error: occured while reading file\");\n          }\n        };\n      });\n    }\n  };\n\n  const photoDeleteHandler = (photoInd: number) => {\n    const newThumbnails = thumbnails.slice();\n    newThumbnails.splice(photoInd, 1);\n    setThumbnails(newThumbnails);\n  };\n\n  return (\n    <div className=\"form-page-container\">\n      <div className=\"form-header-container\">\n        <Status\n          step={step}\n          subStep={subStep}\n          maxSubStep={result.length}\n          isSignedIn={isUserSignedIn(user)}\n        />\n        {/* TODO: category preview */}\n        {headerMsgId && (\n          <div className=\"form-header-msg\">\n            <FormattedMessage id={headerMsgId} values={headerValues} />\n          </div>\n        )}\n      </div>\n      <div className={`form-body-container ${step === 0 ? \"grid-view\" : \"\"}`}>\n        {step < 2 ? (\n          formList?.map((data: SurgicalOption) =>\n            step === 0 ? (\n              <CategoryButton\n                text={data.name}\n                textId={data.textId}\n                key={data.id}\n                selectedIds={selectedIds}\n                id={data.id}\n                onClick={onSelect(\"main\", data.id)}\n                image={imagesMap[data.id]}\n              />\n            ) : (\n              <DescriptionButton\n                text={data.name}\n                textId={data.textId}\n                key={data.id}\n                selectedIds={selectedIds}\n                id={data.id}\n                onClick={onSelect(\"sub\", data.id)}\n              />\n            ),\n          )\n        ) : step === 2 ? (\n          <div className=\"form-thumbnails-container\">\n            {thumbnails.map((thumbnail, ind) => (\n              <PhotoPreview\n                key={ind}\n                src={thumbnail}\n                photoInd={ind}\n                deleteNthPhoto={photoDeleteHandler}\n              />\n            ))}\n            <PhotoInput onPhotoUpload={photoUploadHandler} />\n          </div>\n        ) : step === 3 ? (\n          <div className=\"form-comment-container\">\n            <FormattedMessage id=\"placeholder.leaveComment\">\n              {(message: string) => (\n                <textarea\n                  className=\"form-comment-textarea\"\n                  placeholder={message}\n                  value={comment}\n                  onChange={(e) => setComment(e.target.value)}\n                />\n              )}\n            </FormattedMessage>\n          </div>\n        ) : step === 4 ? (\n          <div className=\"signup-page-container no-padding\">\n            <SignUpForm setSubmitReady={setIsSubmitReady} />\n          </div>\n        ) : (\n          <div className=\"form-complete-container\">\n            <FormattedMessage id=\"form.case5.text\" />\n          </div>\n        )}\n      </div>\n      <div className=\"form-footer-button-container\">\n        {step > 0 && step < 5 && (\n          <Button\n            text=\"Prev\"\n            textId=\"button.previous\"\n            theme=\"gray\"\n            shape=\"round\"\n            onClick={goPrev}\n          />\n        )}\n        {step > 0 && step < 5 && <div className=\"form-footer-gap\" />}\n        <Button\n          text={\n            (isUserSignedIn(user) && step === 3) || step === 4\n              ? \"Submit\"\n              : step === 5\n              ? \"Go to My Page\"\n              : \"Next\"\n          }\n          textId={\n            (isUserSignedIn(user) && step === 3) || step === 4\n              ? \"button.submit\"\n              : step === 5\n              ? \"button.goToMyPage\"\n              : \"button.next\"\n          }\n          theme=\"primary\"\n          shape=\"round\"\n          onClick={goNext}\n          isDisabled={\n            selectedIds.length === 0 || (step === 4 && !isSubmitReady)\n          }\n          isLoading={isSubmitInProgress}\n        />\n      </div>\n    </div>\n  );\n};\n\nexport default Form;\n"]},"metadata":{},"sourceType":"module"}